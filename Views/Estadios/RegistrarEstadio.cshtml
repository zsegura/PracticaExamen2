@model PracticaExamen2.Models.ModelEstadio

<h2>Registrar Estadio</h2>

<form method="post" id="formRegistrarEstadio">
    <div class="form-group">
        <label for="Nombre">Nombre:</label>
        @Html.TextBoxFor(m => m.Nombre, new { @class = "form-control", placeholder = "Nombre del Estadio" })
    </div>

    <div class="form-group">
        <label for="Capacidad">Capacidad:</label>
        @Html.TextBoxFor(m => m.Capacidad, new { @class = "form-control", placeholder = "Capacidad del Estadio" })
    </div>

    <div class="form-group">
        <label for="IdPais">País:</label>
        @Html.DropDownList("IdPais", (SelectList)ViewBag.Paises, "Seleccione un país", new { @class = "form-control", id = "IdPais" })
    </div>

    <div class="form-group">
        <label for="IdCiudad">Ciudad:</label>
        <select id="IdCiudad" name="IdCiudad" class="form-control" required>
            <option value="">Seleccione una ciudad</option>
        </select>
    </div>

    <button type="submit" class="btn btn-primary">Guardar</button>
</form>



@section Scripts {
    <script>
        $(document).ready(function () {
            // Handle dropdown change for IdPais to load IdCiudad
            $("#IdPais").change(function () {
                const countryId = $(this).val();
                if (countryId) {
                    $.getJSON('@Url.Action("Ciudades", "Estadios")', { idPais: countryId }, function (data) {
                        $("#IdCiudad").empty().append('<option value="">Seleccione una ciudad</option>');
                        if (data.error) {
                            alert(data.error); // Handle error messages
                        } else {
                            $.each(data, function (i, item) {
                                $("#IdCiudad").append(`<option value="${item.Id}">${item.Nombre}</option>`);
                            });
                        }
                    }).fail(function (xhr) {
                        alert(`Error fetching cities: ${xhr.responseText}`);
                    });
                } else {
                    $("#IdCiudad").empty().append('<option value="">Seleccione una ciudad</option>');
                }
            });

            // Handle form submission
            $("#formRegistrarEstadio").submit(function (e) {
    e.preventDefault(); // Prevent default form submission
    if ($(this).valid()) {
        $.ajax({
            url: '@Url.Action("RegistrarEstadio", "Estadios")', // Check endpoint URL
            type: 'POST',
            data: $(this).serialize(),
            success: function (response) {
                alert(response); // Show success message
                window.location.href = '/Estadios/ListaEstadios'; // Redirect to the list
            },
            error: function (xhr) {
                alert(`Error: ${xhr.responseText}`);
            }
        });
    }
});

        });
    </script>
}
